<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل / تسجيل دخول السائق - ALLO BILAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background: #0f172a; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin:0; }
    .container { background: rgba(30,41,59,0.9); padding: 30px; border-radius: 16px; width: 320px; }
    h2 { text-align: center; margin-bottom: 20px; }
    input { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: none; }
    button { width: 100%; padding: 10px; border: none; border-radius: 8px; background: #4facfe; color: #0f172a; font-weight: bold; cursor: pointer; }
    button:active { transform: scale(0.98); }
    .switch { margin-top: 10px; text-align: center; font-size: 14px; cursor: pointer; color: #ffd700; }
    .notification { background: #10b981; color: #0f172a; padding: 12px; border-radius: 8px; margin-top: 12px; display: none; text-align: center; }
  </style>
</head>
<body><div class="container" id="authContainer">
  <h2 id="formTitle">تسجيل السائق</h2>
  <input type="text" id="name" placeholder="الاسم الكامل">
  <input type="email" id="email" placeholder="البريد الإلكتروني">
  <input type="password" id="password" placeholder="كلمة المرور">
  <input type="text" id="vehicleType" placeholder="نوع المركبة (motorcycle, car, truck)">
  <button id="authBtn">تسجيل</button>
  <div class="switch" id="switchMode">لديك حساب؟ تسجيل الدخول</div>
  <div class="notification" id="notification"></div>
</div><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script><script>
// إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBPnZzN7DPWRSgiYDAS_bgBqGULL3-MdSU",
  authDomain: "alobilal23.firebaseapp.com",
  projectId: "alobilal23",
  storageBucket: "alobilal23.firebasestorage.app",
  messagingSenderId: "989762991926",
  appId: "1:989762991926:web:822e72a777192f614ae597"
};
if(!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
const auth = firebase.auth();
const db = firebase.firestore();

// المتغيرات
let isLoginMode = false;

// عناصر DOM
const formTitle = document.getElementById('formTitle');
const authBtn = document.getElementById('authBtn');
const switchMode = document.getElementById('switchMode');
const notification = document.getElementById('notification');

// تبديل بين تسجيل ودخول
switchMode.addEventListener('click', () => {
  isLoginMode = !isLoginMode;
  formTitle.textContent = isLoginMode ? 'تسجيل دخول السائق' : 'تسجيل السائق';
  authBtn.textContent = isLoginMode ? 'دخول' : 'تسجيل';
  switchMode.textContent = isLoginMode ? 'ليس لديك حساب؟ تسجيل جديد' : 'لديك حساب؟ تسجيل الدخول';
});

// عرض إشعار
function showNotification(msg, success=true){
  notification.textContent = msg;
  notification.style.background = success ? '#10b981' : '#ef4444';
  notification.style.display = 'block';
  setTimeout(()=>{ notification.style.display='none'; }, 4000);
}

// زر التسجيل/الدخول
authBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const vehicleType = document.getElementById('vehicleType').value.trim() || 'motorcycle';

  if(!email || !password || (!isLoginMode && !name)) { showNotification('الرجاء تعبئة جميع الحقول', false); return; }

  try {
    let user;
    if(isLoginMode){
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      user = userCredential.user;
    } else {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      user = userCredential.user;

      // إنشاء سجل السائق في Firestore
      await db.collection('users').doc(user.uid).set({
        name: name,
        role: 'driver',
        vehicleType: vehicleType,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        isOnline: true
      });
    }

    // بعد التسجيل/الدخول التوجّه مباشرة للوحة التحكم
    window.location.href = 'driver-dashboard.html';

  } catch(error){
    console.error(error);
    showNotification(error.message, false);
  }
});
</script></body>
</html>